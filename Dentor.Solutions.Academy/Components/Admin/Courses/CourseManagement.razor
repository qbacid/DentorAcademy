@page "/admin/courses"

@using Dentor.Academy.WebApp.DTOs.User
@using Dentor.Solutions.Academy.Data
@using Dentor.Solutions.Academy.DTOs.Course
@using Dentor.Solutions.Academy.Extensions
@using Dentor.Solutions.Academy.Interfaces
@using Dentor.Solutions.Academy.Models
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity

@inject IDialogService DialogService
@inject IMessageService MessageServiceProvider
@inject ICourseManagementService CourseService
@inject ICourseCategoryService CategoryService
@inject IUserManagementService UserService
@inject NavigationManager Navigation
@inject UserManager<ApplicationUser> UserManager
@inject AuthenticationStateProvider AuthStateProvider

@attribute [Authorize(Roles = "Admin,Instructor")]
@rendermode InteractiveServer

<PageTitle>Course Management - DentorAcademy</PageTitle>

<!-- Header Section -->
<FluentStack Orientation="Orientation.Horizontal"
             VerticalAlignment="VerticalAlignment.Center"
             Style="width: 100%;">
    <FluentStack Orientation="Orientation.Vertical" Style="flex: 1;">
        <FluentLabel Typo="Typography.HeroTitle">
            <FluentIcon Value="@(new Icons.Regular.Size32.BookOpen())"/>
            Course Management
        </FluentLabel>
        <FluentLabel Typo="Typography.Body">Create and manage courses, categories, and assignments</FluentLabel>
    </FluentStack>
    <FluentButton Appearance="Appearance.Accent"
                  OnClick="ShowCreateCourseDialog"
                  IconStart="@(new Icons.Regular.Size20.AddCircle())">
        New Course
    </FluentButton>
</FluentStack>

<FluentDivider Style="margin-top: 8px; margin-bottom: 8px;"/>

<FluentStack Orientation="Orientation.Vertical" Id="course_container"
             Style="padding: 1rem; margin: 0 auto; width: 100%;">

    <!-- Statistics Cards -->
    <FluentGrid Spacing="3" Style="margin-bottom: 1rem; width: 100%;">
        <FluentGridItem xs="12" sm="6" md="3">
            <CardHeader IconColor="Color.Accent"
                        IconHeader="@(new Icons.Regular.Size32.BookOpen())"
                        Total="@_courses.Count"
                        Description="Total Courses"/>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="3">
            <CardHeader IconColor="Color.Success"
                        Total="@_courses.Count(c => c.IsPublished)"
                        Description="Published Courses"
                        IconHeader="@(new Icons.Regular.Size32.CheckmarkCircle())"/>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="3">
            <CardHeader IconColor="Color.Warning"
                        Total="@_courses.Count(c => !c.IsPublished)"
                        Description="Draft Courses"
                        IconHeader="@(new Icons.Regular.Size32.Document())"/>
        </FluentGridItem>
        <FluentGridItem xs="12" sm="6" md="3">
            <CardHeader IconColor="Color.Info"
                        Total="@_courses.Sum(c => c.EnrollmentCount)"
                        Description="Total Enrollments"
                        IconHeader="@(new Icons.Regular.Size32.People())"/>
        </FluentGridItem>
    </FluentGrid>

    <!-- Courses Content Card -->
    <FluentCard MinimalStyle="true">
        <!-- Toolbar with Filters and View Toggle -->
        <FluentStack Orientation="Orientation.Horizontal"
                     VerticalAlignment="VerticalAlignment.Center"
                     Style="margin-bottom: 1rem; flex-wrap: wrap; gap: 12px;">
            <FluentLabel Typo="Typography.H5" Style="flex: 1;">
                <FluentIcon Value="@(new Icons.Regular.Size20.List())"/>
                All Courses
            </FluentLabel>

            <!-- Filters -->
            <FluentSelect @bind-Value="_filterCategoryId"
                          @bind-Value:after="ApplyFilters"
                          Style="min-width: 200px;"
                          TOption="string">
                <FluentOption Value="">All Categories</FluentOption>
                @foreach (var category in _categories)
                {
                    <FluentOption Value="@category.Id.ToString()">@category.Name</FluentOption>
                }
            </FluentSelect>

            <FluentSelect @bind-Value="_filterPublished"
                          @bind-Value:after="ApplyFilters"
                          Style="min-width: 180px;"
                          TOption="string">
                <FluentOption Value="">All Status</FluentOption>
                <FluentOption Value="true">Published</FluentOption>
                <FluentOption Value="false">Draft</FluentOption>
            </FluentSelect>

            <FluentSearch @bind-Value="_searchTerm"
                          @bind-Value:after="ApplyFilters"
                          Placeholder="Search courses..."
                          Style="min-width: 250px;"/>

            <!-- View Toggle -->
            <FluentButton IconEnd="@(new Icons.Regular.Size20.Grid())"
                          Appearance="@(_viewMode == "grid" ? Appearance.Accent : Appearance.Outline)"
                          OnClick="@(() => _viewMode = "grid")">
                Grid
            </FluentButton>
            <FluentButton IconEnd="@(new Icons.Regular.Size20.List())"
                          Appearance="@(_viewMode == "list" ? Appearance.Accent : Appearance.Outline)"
                          OnClick="@(() => _viewMode = "list")">
                List
            </FluentButton>
        </FluentStack>

        <!-- Courses Grid -->
        @if (_loading)
        {
            <LoadingSpinner Message="Loading courses..."/>
        }
        else if (_filteredCourses.Count == 0)
        {
            <FluentStack Orientation="Orientation.Vertical"
                         HorizontalAlignment="HorizontalAlignment.Center"
                         Style="padding: 2rem 2rem;">
                <FluentIcon Value="@(new Icons.Regular.Size48.BookOpen())" Color="Color.Neutral"/>
                <FluentLabel Typo="Typography.H4">No courses found</FluentLabel>
                <FluentLabel
                    Style="color: #666;">@(_courses.Any()
                        ? "Try adjusting your filters"
                        : "Create your first course to get started!")
                </FluentLabel>
                @if (!_courses.Any())
                {
                    <FluentButton Appearance="Appearance.Accent" OnClick="ShowCreateCourseDialog"
                                  Style="margin-top: 12px;">
                        <FluentIcon Value="@(new Icons.Regular.Size20.AddCircle())" Slot="start"/>
                        Create Course
                    </FluentButton>
                }
            </FluentStack>

            <EmptyState
                Title="No Courses Available"
                Message="@("No courses found in this category. Try adjusting your filters")"
                Icon="@(new Icons.Regular.Size48.BookOpen())"
                ShowAction="false"
                OnAction="ShowCreateCourseDialog"
                ActionText="Create Course"
                ActionUrl="admin/courses"
                RequiredRole="Admin, Instructor"/>
        }
        else if (_viewMode == "grid")
        {
            <!-- Horizontal Scrolling Course Grid -->
            <FluentDivider Style="width: 100%;margin-bottom: 10px;"/>
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="8">
                <div style="overflow-x: auto; padding-bottom: 8px;">
                    <FluentStack Orientation="Orientation.Horizontal" VerticalGap="8"
                                 Style="min-width: min-content;">
                        @foreach (var course in _filteredCourses)
                        {
                            <FluentCard Height="320px"
                                        Style="min-width: 320px; max-width: 320px; display: flex; flex-direction: column;box-shadow:none !important;"
                                        Class="content-card-ns">

                                <!-- Card Header - Thumbnail -->
                                <FluentStack Orientation="Orientation.Horizontal"
                                             VerticalGap="8"
                                             HorizontalGap="4"
                                             VerticalAlignment="VerticalAlignment.Center"
                                             HorizontalAlignment="HorizontalAlignment.End">

                                    <FluentButton
                                        IconStart="@(new Icons.Regular.Size20.FolderOpen())"
                                        Appearance="Appearance.Outline"
                                        @onclick="@(() => ManageContent(course.Id))"></FluentButton>

                                    <FluentButton
                                        IconStart="@(new Icons.Regular.Size20.PeopleTeam())"
                                        Appearance="Appearance.Outline"
                                        @onclick="@(() => ViewCourse(course.Id))"></FluentButton>

                                    <FluentButton
                                        IconStart="@(new Icons.Regular.Size20.Edit())"
                                        @onclick="@(() => EditCourse(course.Id))"
                                        Appearance="Appearance.Outline"/>

                                    <FluentButton
                                        IconStart="@(new Icons.Regular.Size20.Delete())"
                                        Appearance="Appearance.Outline"
                                        OnClick="@(async () => await DeleteCourse(course.Id))"></FluentButton>
                                </FluentStack>
                                <FluentDivider Style="width: 100%;margin-top: 5px;margin-bottom: 5px;"
                                               Orientation="Orientation.Horizontal"/>

                                <div slot="header" style="padding: 0; margin: 0;">
                                    @if (!string.IsNullOrEmpty(course.ThumbnailUrl))
                                    {
                                        <img src="@course.ThumbnailUrl"
                                             alt="@course.Title"
                                             style="width: 100%; height: 180px; object-fit: cover; display: block;"/>
                                    }
                                    else
                                    {
                                        <FluentStack Orientation="Orientation.Vertical"
                                                     HorizontalAlignment="HorizontalAlignment.Center"
                                                     VerticalAlignment="VerticalAlignment.Center"
                                                     Style="width: 100%; height: 180px; background: #f5f5f5;">
                                            <FluentIcon Value="@(new Icons.Regular.Size48.BookOpen())"
                                                        Color="Color.Accent"/>
                                        </FluentStack>
                                    }

                                </div>

                                <!-- Card Body - Content -->
                                <FluentStack Orientation="Orientation.Vertical" VerticalGap="12"
                                             Style="flex: 1; padding: 16px;">

                                    @if (!string.IsNullOrEmpty(course.Category))
                                    {
                                        <FluentBadge Appearance="Appearance.Accent" Style="width: fit-content;">
                                            @course.Category
                                        </FluentBadge>
                                    }

                                    <FluentLabel Typo="Typography.Body" Style="font-weight: 600; font-size: 1.1rem;">
                                        @course.Title
                                    </FluentLabel>
                                    11

                                    <FluentStack Orientation="Orientation.Horizontal" Wrap="true" VerticalGap="8"
                                                 Style="font-size: 0.875rem; color: #6c757d;">
                                        <FluentStack Orientation="Orientation.Horizontal" VerticalGap="4">
                                            <FluentIcon Value="@(new Icons.Regular.Size16.DataHistogram())"/>
                                            <span>@course.DifficultyLevel</span>
                                        </FluentStack>
                                        @if (course.EstimatedDurationHours > 0)
                                        {
                                            <FluentStack Orientation="Orientation.Horizontal" VerticalGap="4">
                                                <FluentIcon Value="@(new Icons.Regular.Size16.Clock())"/>
                                                <span>@course.EstimatedDurationHours hrs</span>
                                            </FluentStack>
                                        }
                                        <FluentStack Orientation="Orientation.Horizontal" VerticalGap="4">
                                            <FluentIcon Value="@(new Icons.Regular.Size16.People())"/>
                                            <span>@course.EnrollmentCount enrolled</span>
                                        </FluentStack>
                                    </FluentStack>

                                    @if (course.Price > 0)
                                    {
                                        <FluentLabel Typo="Typography.Body" Style="font-weight: 600; color: #0078d4;">
                                            $@course.Price.ToString("F2")
                                        </FluentLabel>
                                    }
                                    else
                                    {
                                        <FluentBadge Appearance="Appearance.Neutral"
                                                     Style="font-weight: bold; padding: 2px;"
                                                     Rounded="true"
                                                     Fill="highlight"
                                                     BackgroundColor="green"
                                                     Color="white">
                                            Free
                                        </FluentBadge>
                                    }
                                </FluentStack>
                            </FluentCard>
                        }
                    </FluentStack>
                </div>
            </FluentStack>
        }
        else
        {
            <!-- List View -->
            <FluentPaginator State="@_pagination"/>
            <FluentGrid Spacing="3">
                <FluentGridItem xs="12">
                    <FluentDataGrid MultiLine="true"
                                    Items="@_filteredCourses.AsQueryable()"
                                    Loading="@(_filteredCourses == null)"
                                    TGridItem="CourseListDto"
                                    Style="width: 100%;"
                                    ResizableColumns=true
                                    RowSize="DataGridRowSize.Large">

                        <TemplateColumn Title="Status" Align="@Align.Start">
                            <FluentStack Orientation="Orientation.Horizontal"
                                         VerticalAlignment="VerticalAlignment.Center">
                                @if (context.IsPublished)
                                {
                                    <FluentIcon Value="@(new Icons.Regular.Size16.CheckmarkCircle())"
                                                Color="Color.Success" Title="Published"/>
                                }
                                else
                                {
                                    <FluentIcon Value="@(new Icons.Regular.Size16.Drafts())" Color="Color.Accent"
                                                Title="Draft"/>
                                }
                                <span>@(context.IsPublished ? "Published" : "Draft")</span>
                            </FluentStack>
                        </TemplateColumn>

                        <TemplateColumn Title="Actions" Align="@Align.Start">
                            <FluentStack Orientation="Orientation.Horizontal"
                                         VerticalAlignment="VerticalAlignment.Center">
                                <FluentButton aria-label="Edit" IconStart="@(new Icons.Regular.Size20.Edit())"
                                              @onclick="@(() => EditCourse(context.Id))" Title="Edit"/>

                                <FluentButton aria-label="Delete" IconStart="@(new Icons.Regular.Size20.Delete())"
                                              @onclick="@(() => DeleteCourse(context.Id))" Title="Delete"/>
                            </FluentStack>
                        </TemplateColumn>

                        <PropertyColumn Property="arg => arg.Category"
                                        Sortable="true"
                                        Title="Category Name" HeaderTooltip="Category Name"/>

                        <PropertyColumn Property="arg => arg.Title"
                                        Sortable="true" HeaderTooltip="Course Title"
                                        Title="Course Title"/>

                        <PropertyColumn Property="arg => arg.EnrollmentCount"
                                        Sortable="true" HeaderTooltip="Enrollment"
                                        Title="Enrollment"/>

                        <TemplateColumn Title="Price" Sortable="true" Align="Align.Center">
                            @if (context.Price > 0)
                            {
                                <FluentLabel Typo="Typography.Body" Style="font-weight: 600; color: #0078d4;">
                                    $@context.Price.ToString("F2")
                                </FluentLabel>
                            }
                            else
                            {
                                <FluentBadge Appearance="Appearance.Neutral"
                                             Style="font-weight: bold; padding: 2px;"
                                             Rounded="true"
                                             Fill="highlight"
                                             BackgroundColor="green"
                                             Color="white">
                                    Free
                                </FluentBadge>
                            }
                        </TemplateColumn>

                        <PropertyColumn Property="arg => arg.EstimatedDurationHours"
                                        Sortable="true" HeaderTooltip="Duration in Hours"
                                        Title="Duration (h)"/>

                        <TemplateColumn Title="Difficulty Level" Sortable="true" Align="Align.Center">
                            @switch (context.DifficultyLevel)
                            {
                                case DifficultyLevel.Beginner:
                                    <FluentBadge Appearance="Appearance.Neutral"
                                                 Style="font-weight: bold; padding: 2px;"
                                                 Rounded="true"
                                                 Fill="highlight"
                                                 BackgroundColor="green"
                                                 Color="white">
                                        @context.DifficultyLevel
                                    </FluentBadge>
                                    break;
                                case DifficultyLevel.Intermediate:
                                    <FluentBadge Appearance="Appearance.Neutral"
                                                 Style="font-weight: bold; padding: 2px;"
                                                 Rounded="true"
                                                 Fill="highlight"
                                                 BackgroundColor="yellow"
                                                 Color="black">
                                        @context.DifficultyLevel
                                    </FluentBadge>
                                    break;
                                case DifficultyLevel.Advanced:
                                    <FluentBadge Appearance="Appearance.Neutral"
                                                 Style="font-weight: bold; padding: 2px;"
                                                 Rounded="true"
                                                 Fill="highlight"
                                                 BackgroundColor="red"
                                                 Color="white">
                                        @context.DifficultyLevel
                                    </FluentBadge>
                                    break;
                            }
                        </TemplateColumn>

                    </FluentDataGrid>
                </FluentGridItem>
            </FluentGrid>
        }
    </FluentCard>
</FluentStack>

@code {
    private List<CourseListDto> _courses = new();
    private List<CourseListDto> _filteredCourses = new();
    private List<CourseCategoryDto> _categories = new();
    private List<UserDto> _students = new();
    private List<UserDto> _instructors = new();

    private bool _loading = true;
    private string _viewMode = "grid";
    private string _filterCategoryId = "";
    private string _filterPublished = "";
    private string _searchTerm = "";

    // Pagination for DataGrid
    private readonly PaginationState _pagination = new() { ItemsPerPage = 10 };

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        _loading = true;
        try
        {
            await Task.WhenAll(
                LoadCourses(),
                LoadCategories(),
                LoadUsers()
            );
            ApplyFilters();
        }
        finally
        {
            _loading = false;
        }
    }

    private async Task LoadCourses()
    {
        _courses = await CourseService.GetAllCoursesAsync();
    }

    private async Task LoadCategories()
    {
        _categories = await CategoryService.GetAllCategoriesAsync();
    }

    private async Task LoadUsers()
    {
        var allUsers = await UserService.GetAllUsersAsync();
        _students = allUsers.Where(u => u.Roles.Contains("Student")).ToList();
        _instructors = allUsers.Where(u => u.Roles.Contains("Instructor") || u.Roles.Contains("Admin")).ToList();
    }

    private void ApplyFilters()
    {
        _filteredCourses = _courses;

        // Filter by category
        if (!string.IsNullOrEmpty(_filterCategoryId) && int.TryParse(_filterCategoryId, out int categoryId))
        {
            _filteredCourses = _filteredCourses.Where(c => c.CategoryId == categoryId).ToList();
        }

        // Filter by published status
        if (!string.IsNullOrEmpty(_filterPublished) && bool.TryParse(_filterPublished, out bool isPublished))
        {
            _filteredCourses = _filteredCourses.Where(c => c.IsPublished == isPublished).ToList();
        }

        // Filter by search term
        if (!string.IsNullOrEmpty(_searchTerm))
        {
            _filteredCourses = _filteredCourses
                .Where(c => c.Title.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase) ||
                            (!string.IsNullOrEmpty(c.ShortDescription) && c.ShortDescription.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase)))
                .ToList();
        }
    }

    private async Task ShowCreateCourseDialog()
    {
        var course = new CourseDto { DifficultyLevel = DifficultyLevel.Beginner };
        var dialogData = new CourseDialogData
        {
            Course = course,
            Categories = _categories.ToList()
        };

        var dialog = await DialogService.ShowDialogAsync<CourseDialog>(dialogData, new DialogParameters
        {
            Title = "Create New Course",
            PrimaryAction = "Save Course",
            SecondaryAction = "Cancel",
            Width = "800px",
            Height = "auto",
            Modal = true,
            PreventDismissOnOverlayClick = true
        });

        var result = await dialog.Result;
        if (!result.Cancelled && result.Data is CourseDialogData data)
        {
            await SaveCourse(data);
        }
    }

    private async Task EditCourse(int courseId)
    {
        var course = await CourseService.GetCourseByIdAsync(courseId);
        if (course != null)
        {
            var dialogData = new CourseDialogData
            {
                Course = course,
                Categories = _categories
            };

            var dialog = await DialogService.ShowDialogAsync<CourseDialog>(dialogData, new DialogParameters
            {
                Title = "Edit Course",
                PrimaryAction = "Save Changes",
                SecondaryAction = "Cancel",
                Width = "800px",
                Height = "auto",
                Modal = true,
                PreventDismissOnOverlayClick = true
            });

            var result = await dialog.Result;
            if (!result.Cancelled && result.Data is CourseDialogData data)
            {
                await SaveCourse(data);
            }
        }
    }

    private async Task SaveCourse(CourseDialogData data)
    {
        if (string.IsNullOrWhiteSpace(data.Course.Title))
        {
            MessageServiceProvider.ShowMessageBar(options =>
            {
                options.Title = "Validation Error";
                options.Body = "Please enter a course title";
                options.Intent = MessageIntent.Error;
            });
            return;
        }

        try
        {
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            var userId = UserManager.GetUserId(authState.User);

            InternalOperationResult result;
            if (data.Course.Id == 0)
            {
                result = await CourseService.CreateCourseAsync(data.Course, userId!);
            }
            else
            {
                result = await CourseService.UpdateCourseAsync(data.Course);
            }

            if (result.Success)
            {
                MessageServiceProvider.ShowMessageBar(options =>
                {
                    options.Title = "Success";
                    options.Body = result.Message;
                    options.Intent = MessageIntent.Success;
                });
                await LoadCourses();
                ApplyFilters();
            }
            else
            {
                MessageServiceProvider.ShowMessageBar(options =>
                {
                    options.Title = "Error";
                    options.Body = string.Join(", ", result.Errors);
                    options.Intent = MessageIntent.Error;
                });
            }
        }
        catch (Exception ex)
        {
            MessageServiceProvider.ShowMessageBar(options =>
            {
                options.Title = "Error";
                options.Body = $"Error saving course: {ex.Message}";
                options.Intent = MessageIntent.Error;
            });
        }
    }

    private async Task DeleteCourse(int courseId)
    {
        var dialog = await DialogService.ShowConfirmationAsync(
            "Are you sure you want to delete this course? This action cannot be undone.",
            "Delete",
            "Cancel",
            "Confirm Delete");

        var result = await dialog.Result;
        if (!result.Cancelled)
        {
            try
            {
                var deleteResult = await CourseService.DeleteCourseAsync(courseId);
                if (deleteResult.Success)
                {
                    await MessageServiceProvider.AddDismissibleMessage(nameof(SaveEntityResult.Success), "Course deleted successfully", SaveEntityResult.Success);
                    await LoadCourses();
                    ApplyFilters();
                }
                else
                {
                    await MessageServiceProvider.AddDismissibleMessage(nameof(SaveEntityResult.Error), string.Join(", ", deleteResult.Errors), SaveEntityResult.Error);
                }
            }
            catch (Exception ex)
            {
               await MessageServiceProvider.AddDismissibleMessage(nameof(SaveEntityResult.Error), string.Join(", ", $"Error deleting course: {ex.Message}"), SaveEntityResult.Error);
            }
        }
    }

    private async Task ManageAssignments(int courseId)
    {
        // Prepare assignment data
        var assignmentData = new CourseAssignmentData
        {
            CourseId = courseId,
            Students = _students.Select(s => new UserSelectionDto
            {
                Id = s.Id,
                UserName = s.UserName,
                Email = s.Email,
                IsSelected = false
            }).ToList(),
            Instructors = _instructors.Select(i => new UserSelectionDto
            {
                Id = i.Id,
                UserName = i.UserName,
                Email = i.Email,
                IsSelected = false
            }).ToList()
        };

        // Load existing enrollments
        try
        {
            var enrollments = await CourseService.GetCourseEnrollmentsAsync(courseId);
            var enrolledIds = enrollments.Select(e => e.UserId).ToHashSet();

            foreach (var student in assignmentData.Students)
            {
                student.IsSelected = enrolledIds.Contains(student.Id);
            }
        }
        catch
        {
            /* Ignore errors loading existing enrollments */
        }

        var dialog = await DialogService.ShowDialogAsync<CourseAssignmentDialog>(assignmentData, new DialogParameters
        {
            Title = "Manage Course Assignments",
            PrimaryAction = "Save Assignments",
            SecondaryAction = "Cancel",
            Width = "700px",
            Height = "80vh",
            Modal = true
        });

        var result = await dialog.Result;
        if (!result.Cancelled && result.Data is CourseAssignmentData data)
        {
            await SaveAssignments(data);
        }
    }

    private async Task SaveAssignments(CourseAssignmentData data)
    {
        try
        {
            var selectedStudentIds = data.Students.Where(s => s.IsSelected).Select(s => s.Id).ToList();

            if (selectedStudentIds.Any())
            {
                var result = await CourseService.BulkEnrollUsersAsync(data.CourseId, selectedStudentIds);
                if (result.Success)
                {
                    MessageServiceProvider.ShowMessageBar(options =>
                    {
                        options.Title = "Success";
                        options.Body = $"Successfully enrolled {selectedStudentIds.Count} students";
                        options.Intent = MessageIntent.Success;
                    });
                }
                else
                {
                    MessageServiceProvider.ShowMessageBar(options =>
                    {
                        options.Title = "Error";
                        options.Body = string.Join(", ", result.Errors);
                        options.Intent = MessageIntent.Error;
                    });
                }
            }

            await LoadCourses();
            ApplyFilters();
        }
        catch (Exception ex)
        {
            MessageServiceProvider.ShowMessageBar(options =>
            {
                options.Title = "Error";
                options.Body = $"Error saving assignments: {ex.Message}";
                options.Intent = MessageIntent.Error;
            });
        }
    }

    private void ManageContent(int courseId)
    {
        Navigation.NavigateTo($"/admin/course/{courseId}/content", true);
    }

    private void ViewCourse(int courseId)
    {
        Navigation.NavigateTo($"/course/{courseId}");
    }

}


